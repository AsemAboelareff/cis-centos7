---

- name: "4.2.3 | L1 | PATCH | Ensure permissions on all logfiles are configured"
  command: find /var/log -type f -exec chmod g-wx,o-rwx "{}" +
  changed_when: false
  failed_when: false
  when:
      - rhel7cis_rule_4_2_3
  tags:
      - level1
      - patch
      - automated
      - rule_4.2.3

- name: "4.2.4 | L1 | AUDIT | Ensure logrotate is configured"
  block:
      - name: "4.2.4 | L1 | AUDIT | Ensure logrotate is configured"
        find:
            paths: /etc/logrotate.d/
        register: log_rotate

      - debug:
          var: log_rotate

      - name: "4.2.4 | L1 | AUDIT | Ensure logrotate is configured | set fact"
        set_fact:
            logrotate_files: "{{ logrotate_files + [ item.path ] }}"
        with_items: "{{ log_rotate.files }}"
        no_log: true
        when: log_rotate.examined > 0

      - name: "4.2.4 | L1 | AUDIT | Ensure logrotate is configured | output list"
        debug:
            msg: 
            - WARNING!! The following files need to confirm with site requirements
            - /etc/logrotate.conf
            - "{{ logrotate_files }}"
        when: logrotate_files | length > 0
  vars:
      logrotate_files: []
  when:
      - rhel7cis_rule_4_2_4
  tags:
      - level1
      - audit
      - manual
      - rule_4.2.4
